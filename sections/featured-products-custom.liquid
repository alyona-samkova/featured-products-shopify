{% comment %}
  Featured Products Custom с поддержкой стандартного сниппета пагинации
{% endcomment %}

{{ 'featured-products.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
<script src='{{ 'price-per-item.js' | asset_url }}' defer='defer'></script>
<script src='{{ 'product-form.js' | asset_url }}' defer='defer'></script>
<script src='{{ 'featured-products.js' | asset_url }}' defer='defer'></script>

{%- liquid
  assign featured_collection = collections[section.settings.collection]
  assign cart_product_ids = cart.items | map: 'product_id'
  # Создаем уникальный ID для якоря, чтобы страница скроллилась сюда при переключении
  assign anchor_id = '#section-' | append: section.id
-%}

<featured-products-section
        id='section-{{ section.id }}'
        data-section-id='{{ section.id }}'
        data-section-type='featured-products'
        class='shopify-section featured-products'
>
  <div class='page-width'>
    {%- if section.settings.title != blank -%}
      <h2 class='featured-products__title'>{{ section.settings.title }}</h2>
    {%- endif -%}

    {%- if featured_collection and featured_collection.products_count > 0 -%}
      {%- paginate featured_collection.products by section.settings.product_limit -%}

        <div class='featured-products__grid' id="ProductGrid-{{ section.id }}">
          {%- for product in featured_collection.products -%}
            {%- unless cart_product_ids contains product.id -%}
              {%- render 'featured-product-card', product: product -%}
            {%- endunless -%}
          {%- endfor -%}
        </div>

        {%- if paginate.pages > 1 -%}
          <div class="pagination-wrapper">
            {% comment %}
              Передаем paginate и anchor.
              Anchor заставит браузер прыгнуть обратно к этой секции после перезагрузки.
            {% endcomment %}
            {%- render 'pagination', paginate: paginate, anchor: anchor_id -%}
          </div>
        {%- endif -%}

      {%- endpaginate -%}
    {%- endif -%}
  </div>
</featured-products-section>

{% schema %}
{
  "name": "Featured Products Custom",
  "tag": "section",
  "class": "section section-featured-products-custom",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Featured products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "product_limit",
      "min": 1,
      "max": 24,
      "step": 1,
      "label": "Products per page",
      "default": 4
    }
  ],
  "presets": [
    {
      "name": "Featured Products Custom"
    }
  ]
}
{% endschema %}